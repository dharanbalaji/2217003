<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; background-color: #f4f4f4; }
        .url-group { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        label { display: block; margin-bottom: 5px; }
        input { margin-bottom: 10px; width: 100%; padding: 6px; }
        h1, h2 { text-align: center; }
        .submit-btn, .stats-btn { display: block; margin: 10px auto; padding: 10px 30px; }
        .url-stats { background: #fff; margin-bottom: 30px; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px #ddd; }
        .click-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .click-table th, .click-table td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        .click-table th { background: #eee; }
    </style>
</head>
<body>
    <h1>URL SHORTENER</h1>
    <h2>SHORT THE URL AS YOU REQUIRE</h2>
    
    <div class="url-group">
        <label for="url2">Original URL:</label>
        <input type="text" id="url2" placeholder="Enter your long URL here">
        
        <label for="validity2">Validity Period (minutes):</label>
        <input type="number" id="validity2" placeholder="Optional">
        
        <label for="shortcode2">Preferred Shortcode:</label>
        <input type="text" id="shortcode2" placeholder="Optional">
    </div>
    <button class="submit-btn">Shorten URLs</button>
    <button class="stats-btn">Show Stats</button>

    <div id="result"></div>
    <div id="stats"></div>
    <script>
    function isValidURL(url) {
        try {
            new URL(url);
            return true;
        } catch {
            return false;
        }
    }

    // Store stats for session
    const statsData = [];

    document.querySelector('.submit-btn').addEventListener('click', function() {
        const url = document.getElementById('url2').value.trim();
        const validity = document.getElementById('validity2').value.trim();
        const shortcode = document.getElementById('shortcode2').value.trim();
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';
        document.getElementById('stats').innerHTML = '';

        // Validation
        let errors = [];
        if (!isValidURL(url)) errors.push('Please enter a valid URL.');
        if (validity && (!Number.isInteger(Number(validity)) || Number(validity) <= 0)) {
            errors.push('Validity must be a positive integer.');
        }
        if (errors.length) {
            resultDiv.innerHTML = '<span style="color:red">' + errors.join('<br>') + '</span>';
            return;
        }

        // Mock API response
        const shortUrl = 'https://short.ly/' + (shortcode || Math.random().toString(36).substr(2, 6));
        const created = new Date().toLocaleString();
        const expiry = validity ? new Date(Date.now() + Number(validity) * 60000).toLocaleString() : 'Never';

        resultDiv.innerHTML = `
            <div style="margin-top:20px;padding:10px;border:1px solid #ccc;border-radius:6px;">
                <strong>Original URL:</strong> ${url}<br>
                <strong>Shortened URL:</strong> <a href="${shortUrl}" target="_blank">${shortUrl}</a><br>
                <strong>Expiry:</strong> ${expiry}
            </div>
        `;

        // Add to statsData
        statsData.push({
            shortUrl,
            originalUrl: url,
            created,
            expiry,
            clickCount: 0,
            clicks: []
        });
    });

    // Simulate click tracking (for demo purposes)
    function simulateClick(shortUrl) {
        const sources = ["Email", "WhatsApp", "Direct", "Facebook"];
        const locations = ["India", "USA", "UK", "Canada"];
        const stat = statsData.find(s => s.shortUrl === shortUrl);
        if (stat) {
            stat.clickCount += 1;
            stat.clicks.push({
                timestamp: new Date().toLocaleString(),
                source: sources[Math.floor(Math.random() * sources.length)],
                location: locations[Math.floor(Math.random() * locations.length)]
            });
        }
    }

    // Show stats for all shortened URLs in session
    document.querySelector('.stats-btn').addEventListener('click', function() {
        // For demo, simulate some clicks
        statsData.forEach(stat => {
            if (stat.clickCount === 0) {
                simulateClick(stat.shortUrl);
                simulateClick(stat.shortUrl);
            }
        });

        const statsDiv = document.getElementById('stats');
        if (statsData.length === 0) {
            statsDiv.innerHTML = "<div style='color:red'>No URLs shortened yet.</div>";
            return;
        }
        statsDiv.innerHTML = statsData.map(url => `
            <div class="url-stats">
                <strong>Shortened URL:</strong> <a href="${url.shortUrl}" target="_blank">${url.shortUrl}</a><br>
                <strong>Original URL:</strong> ${url.originalUrl}<br>
                <strong>Created:</strong> ${url.created}<br>
                <strong>Expiry:</strong> ${url.expiry}<br>
                <strong>Total Clicks:</strong> ${url.clickCount}
                <h4>Click Details:</h4>
                <table class="click-table">
                    <tr>
                        <th>Timestamp</th>
                        <th>Source</th>
                        
                    </tr>
                    ${url.clicks.map(click => `
                        <tr>
                            <td>${click.timestamp}</td>
                            <td>${click.source}</td>
                        </tr>
                    `).join('')}
                </table>
            </div>
        `).join('');
    });
    </script>
</body>
</html>